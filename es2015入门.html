<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>es2015入门 | korubak blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="es2015入门Why es2015语言环境支持2015年6月，ECMAScript 2015(也叫es6) 得到了批准。这是ECMAScript这门语言继2009年的ES5之后的最大进步。如果还对新的语言特性不甚了解，来看看es2015发展到什么地步了吧。

nodejs 6.50 以上版本对es2015的支持达到了99% (参考node.green)
chrome 52 对es2015的支持达">
<meta property="og:type" content="article">
<meta property="og:title" content="es2015入门">
<meta property="og:url" content="http://korubak.github.io/es2015入门.html">
<meta property="og:site_name" content="korubak blog">
<meta property="og:description" content="es2015入门Why es2015语言环境支持2015年6月，ECMAScript 2015(也叫es6) 得到了批准。这是ECMAScript这门语言继2009年的ES5之后的最大进步。如果还对新的语言特性不甚了解，来看看es2015发展到什么地步了吧。

nodejs 6.50 以上版本对es2015的支持达到了99% (参考node.green)
chrome 52 对es2015的支持达">
<meta property="og:updated_time" content="2016-10-19T08:32:47.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="es2015入门">
<meta name="twitter:description" content="es2015入门Why es2015语言环境支持2015年6月，ECMAScript 2015(也叫es6) 得到了批准。这是ECMAScript这门语言继2009年的ES5之后的最大进步。如果还对新的语言特性不甚了解，来看看es2015发展到什么地步了吧。

nodejs 6.50 以上版本对es2015的支持达到了99% (参考node.green)
chrome 52 对es2015的支持达">
  
  
    <link rel="icon" href="/favicon.png">
  
  
 <link href='//fonts.css.network/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
 <link href="//fonts.css.network/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">


  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  

  

  
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo" style="background-image: url(/css/images/logo.png)"></i><span class="site-title">korubak blog</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/.">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/css/images/avatar.png"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
      
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://korubak.github.io"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
        
          <td><a class="main-nav-link" href="/.">Home</a></td>
        
          <td><a class="main-nav-link" href="/archives">Archives</a></td>
        
          <td><a class="main-nav-link" href="/categories">Categories</a></td>
        
          <td><a class="main-nav-link" href="/tags">Tags</a></td>
        
          <td><a class="main-nav-link" href="/about">About</a></td>
        
        <td>
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://korubak.github.io"></form>
        </td>
      </tr>
    </table>
  </div>
</header>

    <div class="outer">
      
        <aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      <img id="avatar" src="/css/images/avatar.png">
      <h2 id="name">Zhang Jingfeng</h2>
      <h3 id="title">Web Developer &amp; Front end</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Beijing, China</span>
      <a id="follow" href="https://github.com/korubak/">关注我</a>
    </div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        4
        <span>文章</span>
      </div>
      <div class="article-info-block">
        3
        <span>标签</span>
      </div>
    </div>
    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
          
          <td><a href="http://github.com/korubak" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
          
          <td><a href="#" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
          
          <td><a href="#" target="_blank" title="facebook"><i class="fa fa-facebook"></i></a></td>
          
          <td><a href="#" target="_blank" title="dribbble"><i class="fa fa-dribbble"></i></a></td>
          
          <td><a href="/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
          
        </tr>
      </table>
    </div>
    
    
  </div>
</aside>

      
      <section id="main"><article id="post-es2015入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      es2015入门
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/es2015入门.html">
      <time datetime="2016-09-07T07:38:00.000Z" itemprop="datePublished">2016-09-07</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/front-end/">front-end</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <h1 id="es2015入门"><a href="#es2015入门" class="headerlink" title="es2015入门"></a>es2015入门</h1><h2 id="Why-es2015"><a href="#Why-es2015" class="headerlink" title="Why es2015"></a>Why es2015</h2><h3 id="语言环境支持"><a href="#语言环境支持" class="headerlink" title="语言环境支持"></a>语言环境支持</h3><p>2015年6月，ECMAScript 2015(也叫es6) 得到了批准。这是ECMAScript这门语言继2009年的ES5之后的最大进步。如果还对新的语言特性不甚了解，来看看es2015发展到什么地步了吧。</p>
<ul>
<li>nodejs 6.50 以上版本对es2015的支持达到了<strong>99%</strong> <a href="http://node.green/" target="_blank" rel="external">(参考node.green)</a></li>
<li>chrome 52 对es2015的支持达到了<strong>97%</strong>，firefox 51达到了<strong>94%</strong>，edge 14达到了<strong>95%</strong></li>
<li>safari 10.0 对es2015的支持达到了<strong>100%</strong></li>
<li>通过Babel可以将<strong>71%</strong>的es2015代码编译成es5的代码，在不支持es2015的浏览器上运行 <a href="http://kangax.github.io/compat-table/es6/" target="_blank" rel="external">参考http://kangax.github.io/</a></li>
<li>后向兼容es5的语法</li>
</ul>
<a id="more"></a>
<h3 id="语法糖"><a href="#语法糖" class="headerlink" title="语法糖"></a>语法糖</h3><p>距离1995年推出javascript已经过去很多年了，但是这门语言并没有太大的改变；然而新语言层出不穷，es5中的一些语法特性早已过时。因此es2015吸收了其他语言中的一些新特性、语法糖，让开发者能够更舒适、简洁地开发应用。</p>
<h3 id="标准统一"><a href="#标准统一" class="headerlink" title="标准统一"></a>标准统一</h3><p>为了在es5中实现模块化、类以及Promise，开发者们自创了很多实现方式。es2015吸收了这些实现的优点，并提供了统一的模块化加载、类定义、Promise对象、Set和Map等容器，让开发者远离选择的烦恼。</p>
<h2 id="es2015新特性介绍"><a href="#es2015新特性介绍" class="headerlink" title="es2015新特性介绍"></a>es2015新特性介绍</h2><p>如果安装了52以上的chrome，可以直接在浏览器的console中尝试下面的代码，或者在6.5版本以上的node环境中运行下面的代码。</p>
<h3 id="全新的变量使用"><a href="#全新的变量使用" class="headerlink" title="全新的变量使用"></a>全新的变量使用</h3><hr>
<h4 id="let、const"><a href="#let、const" class="headerlink" title="let、const"></a>let、const</h4><p>let可以看成是var的升级版。不过let不允许重复定义，不存在变量声明提前，不会变成全局对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span>;     <span class="comment">//报错，不存在变量声明提前</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> b = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span>; <span class="comment">//报错，不允许重复定义</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.c);  <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">let</span> d = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.d);  <span class="comment">// undefined，不会变成全局对象</span></span><br></pre></td></tr></table></figure>
<p>const则是声明一个不可重新赋值的变量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> E = &#123;&#125;;</span><br><span class="line">E.a = <span class="number">1</span>;      <span class="comment">//可以修改变量的属性</span></span><br><span class="line">E = &#123;&#125;;       <span class="comment">//error，不允许重新赋值</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h4><p>es5中，只有函数才能产生变量作用域；es2015中，只要是括号就能产生作用域了，不过为了保持兼容，块级作用域仅对let声明的对象有效。for循环与let结合使用可以有很好的效果。块级作用域也能代替立即执行函数的作用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> f = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(e);    <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(f);    <span class="comment">// error：f在块级作用域外部未声明</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> g = <span class="number">1</span>; g &lt; <span class="number">3</span>; g++) &#123;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(g);    <span class="comment">// error：g在块级作用域外部未声明</span></span><br></pre></td></tr></table></figure>
<p>块级作用域代替立即执行函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;</span><br><span class="line">&#123;</span><br><span class="line">    function h() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(h);    // error：未声明；再也不用担心污染全局变量了</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">for (let i = 1; i &lt; 5; i++) &#123;</span><br><span class="line">    setTimeout(function () &#123;</span><br><span class="line">        console.log(i);</span><br><span class="line">    &#125;, 500);       // 还记得这道神奇的面试题吗？在这里会输出1~4</span><br><span class="line">&#125;</span><br><span class="line">// 上面等价于</span><br><span class="line">for (var i = 1; i &lt; 5; i++) &#123;</span><br><span class="line">    (function (i) &#123;</span><br><span class="line">	    setTimeout(function () &#123;</span><br><span class="line">	        console.log(i);</span><br><span class="line">	    &#125;, 500);</span><br><span class="line">    &#125;)(i);         // 这里块级作用域等价于一个立即执行函数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><hr>
<h4 id="对象变量的声明"><a href="#对象变量的声明" class="headerlink" title="对象变量的声明"></a>对象变量的声明</h4><p>对象变量的声明现在有更简洁的写法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    a,</span><br><span class="line">    b() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">等价于</span><br><span class="line"><span class="keyword">let</span> obja = &#123;</span><br><span class="line">    a: a,</span><br><span class="line">    b: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="对象变量的解构赋值"><a href="#对象变量的解构赋值" class="headerlink" title="对象变量的解构赋值"></a>对象变量的解构赋值</h4><p>变量的赋值更灵活了，可以将数组或对象的某一属性解构为变量并赋值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;key: j&#125; = &#123;key: <span class="string">'123'</span>&#125;; <span class="comment">// j='123'</span></span><br><span class="line"><span class="keyword">let</span> [k] = <span class="string">'321'</span>;             <span class="comment">// k='3'</span></span><br><span class="line">[j, k] = [k, j];             <span class="comment">// 交换值j和k的值，爽！</span></span><br></pre></td></tr></table></figure>
<p>结构赋值在函数中也能灵活使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> l = (<span class="function"><span class="keyword">function</span> (<span class="params">&#123;key: j&#125;</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(j);          <span class="comment">// j='123'</span></span><br><span class="line">    <span class="keyword">return</span> &#123;newkey: j&#125;;</span><br><span class="line">&#125;)(&#123;key: <span class="string">'123'</span>&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(l);              <span class="comment">// l=&#123;newkey: '123'&#125;</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Object-assign"><a href="#Object-assign" class="headerlink" title="Object.assign"></a>Object.assign</h4><p>Object.assign 可以代替 $.extend</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> m = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123;a: <span class="number">1</span>&#125;, &#123;b: <span class="number">2</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(m);              <span class="comment">// &#123;a: 1, b: 2&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><hr>
<h4 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h4><p>在js中写html再也不用多余的加号或者逗号了，使用模板字符串轻松搞定传值、换行和排版，这应该也是react等框架推荐es2015的原因。使用<figure class="highlight plain"><figcaption><span>```即可。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">let n = &#123;a: &apos;world&apos;&#125;;</span><br><span class="line">console.log(`</span><br><span class="line">    Hello</span><br><span class="line">    $&#123;n.a&#125;</span><br><span class="line">`);</span><br></pre></td></tr></table></figure></p>
<p>可以传入任何值，甚至嵌套使用函数和模板字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n1 =<span class="string">'!'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Hello world<span class="subst">$&#123;`$&#123;n1&#125;</span>`</span>.repeat(<span class="number">3</span>)&#125;<span class="string">`);</span><br><span class="line">//输出 'Hello world!!!'</span></span><br></pre></td></tr></table></figure>
<h3 id="正确处理Unicode"><a href="#正确处理Unicode" class="headerlink" title="正确处理Unicode"></a>正确处理Unicode</h3><p>js使用 <code>\u</code> 表示汉字时，只限于\u0000——\uFFFF之间的字符。超出这个范围的字符，必须用两个双字节的形式表达。es2015可以通过大括号解决这一问题，并提供了新的字符串处理函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"\uD842\uDFB7"</span>                    <span class="comment">// "𠮷"</span></span><br><span class="line"><span class="string">"\u20BB7"</span>                         <span class="comment">// " 7"</span></span><br><span class="line"><span class="string">"&#123;\u20BB7&#125;"</span>                       <span class="comment">// "𠮷"</span></span><br><span class="line"><span class="string">"𠮷"</span>.codePointAt(<span class="number">0</span>) == <span class="number">0x20BB7</span>    <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><hr>
<h4 id="新的声明方式"><a href="#新的声明方式" class="headerlink" title="新的声明方式"></a>新的声明方式</h4><p>可以摒弃带有歧义的老的声明方式了，使用Array.of。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>(<span class="number">3</span>);                    <span class="comment">// [undefined * 3]</span></span><br><span class="line"><span class="built_in">Array</span>(<span class="string">'3'</span>);                  <span class="comment">// ['3'] 易造成歧义</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="number">3</span>);                 <span class="comment">// [3] </span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="string">'3'</span>);               <span class="comment">// ['3']</span></span><br></pre></td></tr></table></figure>
<h4 id="计算字符个数"><a href="#计算字符个数" class="headerlink" title="计算字符个数"></a>计算字符个数</h4><p>使用Array.from可以把一个字符串转化为数组，然后计算数组的长度即可得到字符个数，重点是可以<strong>处理生僻中文字符</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'𠮷'</span>.split(<span class="string">''</span>).length        <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">Array</span>.from(<span class="string">'𠮷'</span>).length;     <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="spread运算符-…"><a href="#spread运算符-…" class="headerlink" title="spread运算符 …"></a>spread运算符 …</h4><p>spread运算符很强大，可以把数组转为参数，也能把参数转为数组，还能把数组转为数组，非常酷炫。</p>
<p>把数组转为参数 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);          <span class="comment">// 1</span></span><br><span class="line">    <span class="built_in">console</span>.log(b);          <span class="comment">// 2</span></span><br><span class="line">&#125;)(...[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure>
<p>把多余的参数转为数组 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">a, ...b</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);          <span class="comment">// 1</span></span><br><span class="line">    <span class="built_in">console</span>.log(b);          <span class="comment">// [2, 3, 4, 5]</span></span><br><span class="line">&#125;)(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p>把数组转为数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">a, ...b</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log([...b, <span class="number">6</span>]);      <span class="comment">// [2, 3, 4, 5, 6]</span></span><br><span class="line">    <span class="built_in">console</span>.log([...arguments]); <span class="comment">// [1, 2, 3, 4, 5]</span></span><br><span class="line">    <span class="built_in">console</span>.log([...<span class="string">'abc'</span>]);     <span class="comment">// ['a', 'b', 'c']</span></span><br><span class="line">&#125;)(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="数组遍历"><a href="#数组遍历" class="headerlink" title="数组遍历"></a>数组遍历</h4><p>强大的for…of遍历方式，直接获得数组的值，再也不需要forEach了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;  <span class="comment">// 'a' 'b' 'c'</span></span><br></pre></td></tr></table></figure>
<p>通过entries，keys分别得到键值数组和键数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>].keys()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;  <span class="comment">// 'a' 'b' 'c'</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>].entries()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;  <span class="comment">// [0,'a'] [1,'b'] [2, 'c']</span></span><br></pre></td></tr></table></figure>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><hr>
<h4 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h4><p>可以为函数指定默认参数，既可以避免异常情况，也能减少文档的书写，让读者一目了然，知道应该传哪种类型的参数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">x = 1, y = false</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x, y);  <span class="comment">// 2 false</span></span><br><span class="line">&#125;)(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h4><p>没有什么比箭头函数更能省代码了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = v =&gt; v;</span><br><span class="line">等价于</span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>箭头函数基本上用在数组的回调函数中，简单明了(function、return和括号能干掉的都干掉)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].filter(x =&gt; x &lt; <span class="number">3</span>)</span><br><span class="line">         .map(x =&gt; <span class="number">2</span> * x)</span><br><span class="line">         .reduce((p, c)=&gt; p + c)</span><br></pre></td></tr></table></figure>
<p>箭头函数有四个注意点</p>
<ol>
<li>函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。</li>
<li>不可以当作构造函数，也就是说，不可以使用new命令，否则会抛出一个错误。</li>
<li>不可以使用arguments对象，该对象在函数体内不存在。如果要用，可以用Rest参数代替。</li>
<li>不可以使用yield命令，因此箭头函数不能用作Generator函数。</li>
</ol>
<p>第1点可以归纳为定义时绑定了一个this对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">    val: <span class="number">3</span>,</span><br><span class="line">    say: () =&gt; <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line">等价于</span><br><span class="line"><span class="keyword">let</span> a1 = &#123;</span><br><span class="line">    val: <span class="number">3</span>,</span><br><span class="line">    say: (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">    &#125;).bind(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line">a.say();  <span class="comment">// window</span></span><br><span class="line">a1.say(); <span class="comment">// window</span></span><br></pre></td></tr></table></figure>
<h3 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h3><hr>
<h4 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h4><p>所有可遍历的内置对象在es2015中都拥有一个属性，这个属性Symbol.iterator是一个可以运行的函数，返回值是一个迭代器对象。迭代器对象有next方法，可以通过next方法对原始对象进行遍历。遍历结束后，返回的对象里done属性变成了true。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">let</span> it = <span class="string">'abc'</span>[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line">	it.next();    <span class="comment">// &#123;value: 'a', done: false&#125;</span></span><br><span class="line">	it.next();    <span class="comment">// &#123;value: 'b', done: false&#125;</span></span><br><span class="line">	it.next();    <span class="comment">// &#123;value: 'c', done: false&#125;</span></span><br><span class="line">	it.next();    <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br><span class="line">	it.next();    <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有拥有Iterator接口的对象不仅能够通过迭代器遍历，而且都能调用for…of方法进行遍历。事实上，for…of的原理就是调用的迭代器接口进行遍历，遍历的变量也就是上面返回的value值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>];</span><br><span class="line">    <span class="keyword">let</span> it = arr[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> arr) &#123;</span><br><span class="line">       <span class="built_in">console</span>.log(i == it.next().value); <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就意味着，为对象添加合适的迭代器，就能够使用for…of进行遍历了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">let</span> obj = &#123;</span><br><span class="line">	  data: <span class="number">10</span>,</span><br><span class="line">	  [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">	    <span class="keyword">const</span> self = <span class="keyword">this</span>;</span><br><span class="line">	    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">	    <span class="keyword">return</span> &#123;</span><br><span class="line">	      next() &#123;</span><br><span class="line">	        <span class="keyword">if</span> (index &lt; self.data) &#123;</span><br><span class="line">	          index++;</span><br><span class="line">	          <span class="keyword">return</span> &#123;</span><br><span class="line">	            value: -index,</span><br><span class="line">	            done: <span class="literal">false</span></span><br><span class="line">	          &#125;;</span><br><span class="line">	        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	          <span class="keyword">return</span> &#123; value: <span class="literal">undefined</span>, done: <span class="literal">true</span> &#125;;</span><br><span class="line">	        &#125;</span><br><span class="line">	      &#125;</span><br><span class="line">	    &#125;;</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> obj) &#123;</span><br><span class="line">	    <span class="built_in">console</span>.log(i);    <span class="comment">// -1 ~ -10</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Set-和-Map"><a href="#Set-和-Map" class="headerlink" title="Set 和 Map"></a>Set 和 Map</h3><p>Set和Map作为常见的容器，在es2015中也进行了标准化。Set和Map自身拥有Iterator接口，可以用for…of遍历。同样，也可以从拥有iterator接口的对象转换过来。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>(<span class="string">'ab'</span>);                <span class="comment">// Set &#123;'a', 'b'&#125;</span></span><br><span class="line">    <span class="keyword">let</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="string">'ab'</span>], [<span class="string">'c'</span>, <span class="string">'d'</span>]]);</span><br><span class="line">    <span class="comment">// Map &#123;'ab'=&gt;undefined, 'c'=&gt;'d'&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Set 拥有4个操作方法</p>
<ul>
<li>add(value)：添加某个值，返回Set结构本身。</li>
<li>delete(value)：删除某个值，返回一个布尔值，表示删除是否成功。</li>
<li>has(value)：返回一个布尔值，表示该值是否为Set的成员。</li>
<li>clear()：清除所有成员，没有返回值。</li>
</ul>
<p>Map 拥有5个操作方法</p>
<ul>
<li>set(key, value)：添加某个键值对，返回Map结构本身。</li>
<li>get(key)：方法读取key对应的键值，如果找不到key，返回undefined。</li>
<li>has(value)：返回一个布尔值，表示该key是否为在Map中。</li>
<li>delete(value)：删除某个键，返回true。如果删除失败，返回false。</li>
<li>clear()：清除所有成员，没有返回值。</li>
</ul>
<p>事实上在es5中，我们也能用对象来模拟Map和Set，然而es2015中的Set和Map有如下优点：</p>
<ul>
<li>es5中对象的属性值只能是字符串，Map和Set的键值可以为任意值或对象。</li>
<li>Map和Set实现了Iterator接口，更易遍历和转换成其他对象。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="literal">true</span>, <span class="literal">undefined</span>, <span class="literal">NaN</span>, <span class="literal">null</span>]);</span><br><span class="line">    s = <span class="keyword">new</span> <span class="built_in">Set</span>([...s].map(v =&gt; !v));   <span class="comment">// 更便捷的遍历</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">    m.set(<span class="literal">NaN</span>, <span class="number">1</span>);</span><br><span class="line">    m.set(<span class="literal">NaN</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> [k, v] <span class="keyword">of</span> m) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(k, v);   <span class="comment">// NaN 2，Map中键只能出现一次</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="weakSet-和-weakMap"><a href="#weakSet-和-weakMap" class="headerlink" title="weakSet 和 weakMap"></a>weakSet 和 weakMap</h3><p>WeakSet 和 Set 不同之处在于， WeakSet中的对象引用不计入垃圾回收机制，WeakMap也是如此。也就是说，垃圾回收不会考虑这个对象是不是在WeakSet里。这有什么用处呢？安全机制。下面的代码确保了在调用method时，首先对Request进行了初始化，同时WeakSet中的对象仍然会被垃圾回收，避免实例浪费内存。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reqs = <span class="keyword">new</span> <span class="built_in">WeakSet</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// do Something important</span></span><br><span class="line">    reqs.add(<span class="keyword">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  method () &#123;</span><br><span class="line">    <span class="keyword">if</span> (!reqs.has(<span class="keyword">this</span>)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'只能在Request实例上调用！'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><hr>
<h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>Generator 是一种特殊的函数，不仅有return语句，也有yield语句。return会返回一个值并终止函数，yield只是返回一个值，可以看做是『没有终止功能的return』。定义时用 <code>*</code> 来表示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">helloWorldGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'hello'</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'world'</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'ending'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><p>和遍历的用法一样，Generator函数调用只会返回一个iterator，需要调用iterator的next方法才能产生值，并且函数的执行会在yield处暂停。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">function</span>* <span class="title">helloWorldGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	  <span class="keyword">yield</span> <span class="string">'hello'</span>;</span><br><span class="line">	  <span class="keyword">yield</span> <span class="string">'world'</span>;</span><br><span class="line">	  <span class="keyword">return</span> <span class="string">'ending'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">let</span> g = helloWorldGenerator();</span><br><span class="line">	g.next();    <span class="comment">// &#123;value: "hello", done: false&#125;</span></span><br><span class="line">	g.next();    <span class="comment">// &#123;value: "world", done: false&#125;</span></span><br><span class="line">	g.next();    <span class="comment">// &#123;value: "ending", done: true&#125;</span></span><br><span class="line">	g.next();    <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>yield后面也可以跟随表达式, next 和初始化函数中也可以带入参数。next中传入的参数可以看成是覆盖上一个yield的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">	  <span class="keyword">var</span> y = <span class="number">2</span> * (<span class="keyword">yield</span> (x + <span class="number">1</span>));</span><br><span class="line">	  <span class="keyword">var</span> z = <span class="keyword">yield</span> (y / <span class="number">3</span>);</span><br><span class="line">	  <span class="keyword">return</span> (x + y + z);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> b = foo(<span class="number">5</span>); </span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 *  下面等价于 </span><br><span class="line">	 *  function(x = 5) &#123;</span><br><span class="line">	 *      return x + 1;</span><br><span class="line">	 *  &#125;</span><br><span class="line">	 */</span> </span><br><span class="line">	b.next()   <span class="comment">// &#123; value:6, done:false &#125;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 *  下面等价于 </span><br><span class="line">	 *  function(x1 = 12) &#123;</span><br><span class="line">	 *      var y = 2 * x1; </span><br><span class="line">	 *      return y / 3;</span><br><span class="line">	 *  &#125;</span><br><span class="line">	 */</span> </span><br><span class="line">	b.next(<span class="number">12</span>) <span class="comment">// &#123; value:8, done:false &#125;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 *  下面等价于 </span><br><span class="line">	 *  function(x = 5, y = 24, y1 = 13) &#123;</span><br><span class="line">	 *      var z = y1; </span><br><span class="line">	 *      return x + y + z;</span><br><span class="line">	 *  &#125;</span><br><span class="line">	 */</span> </span><br><span class="line">	b.next(<span class="number">13</span>) <span class="comment">// &#123; value:42, done:true &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于next方法的参数表示上一个yield语句的返回值，所以第一次使用next方法时，不能带有参数。V8引擎直接忽略第一次使用next方法时的参数，只有从第二次使用next方法开始，参数才是有效的。从语义上讲，第一个next方法用来启动遍历器对象，所以不用带有参数。</p>
<hr>
<h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><p>Generator能够让代码变得更好看，是回调函数的克星。以发送ajax请求为例，下面的main函数中，获取请求数据就像同步获取一样， 而不用考虑请求的发送过程。而之前如果需要分离业务和功能型代码，则需要大把的回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// before</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = request(<span class="string">"http://some.url"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="built_in">JSON</span>.parse(result);</span><br><span class="line">    <span class="built_in">console</span>.log(resp.value);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url, cb</span>) </span>&#123;</span><br><span class="line">  makeAjaxCall(url, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    cb(response);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">main();</span><br><span class="line"></span><br><span class="line"><span class="comment">// after</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="keyword">yield</span> request(<span class="string">"http://some.url"</span>);</span><br><span class="line">  <span class="keyword">var</span> resp = <span class="built_in">JSON</span>.parse(result);</span><br><span class="line">  <span class="built_in">console</span>.log(resp.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  makeAjaxCall(url, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    it.next(response);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> it = main();</span><br><span class="line">it.next();</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>es2015统一了Promise的标准。Promise对象是一个构造函数，用来生成Promise实例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... some code</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Promise构造函数接受一个函数作为参数，该函数的两个参数分别是resolve和reject。它们是两个函数，由JavaScript引擎提供，不用自己部署。</p>
<p>Promise实例生成以后，可以用then方法分别指定Resolved状态和Reject状态的回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// success</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// failure</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h3><p>es2015中终于统一了Class的标准，并提供了class的使用方法。在下面的代码中，实现了类的继承，构造函数，父类构造函数,实例方法以及静态方法。目前es2015不支持在类中定义属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> <span class="keyword">extends</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(x, y, color) &#123;</span><br><span class="line">    <span class="keyword">super</span>(x, y); <span class="comment">// 调用父类的constructor(x, y)</span></span><br><span class="line">    <span class="keyword">this</span>.color = color;</span><br><span class="line">  &#125;</span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.color + <span class="keyword">super</span>.toString(); <span class="comment">//父类的toString()</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> classMethod() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h3><p>在ES6之前，社区制定了一些模块加载方案，最主要的有CommonJS和AMD两种。前者用于服务器，后者用于浏览器。ES6在语言规格的层面上，实现了模块功能，而且实现得相当简单，完全可以取代现有的CommonJS和AMD规范，成为浏览器和服务器通用的模块解决方案。(此处内容无法在浏览器中直接试用)</p>
<h3 id="模块的输出"><a href="#模块的输出" class="headerlink" title="模块的输出"></a>模块的输出</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstName = <span class="string">'Michael'</span>;</span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> year = <span class="number">1958</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    firstName, </span><br><span class="line">    func, </span><br><span class="line">    year <span class="keyword">as</span> y   <span class="comment">// 重命名输出的模块</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="模块的输入"><a href="#模块的输入" class="headerlink" title="模块的输入"></a>模块的输入</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;firstName, lastName, y <span class="keyword">as</span> year&#125; <span class="keyword">from</span> <span class="string">'./profile'</span>;</span><br></pre></td></tr></table></figure>
<p>默认模块的输出和加载</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">var</span> m = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> anyname <span class="keyword">from</span> <span class="string">'./profile'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>本文只是一个初步的介绍，关于es2015入门更多详细知识，可以参考 <a href="http://es6.ruanyifeng.com/" target="_blank" rel="external">ECMAScript 6入门</a>。</p>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>es2015目前只有部分特性可以通过babel转化成es5使用，本文将会使用webpack构建一个简单的es2015项目。（截图功能需要新版chrome才能运行）</p>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul>
<li>npm 3.8.9</li>
<li>node 6.2<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">进入任意目录</span><br><span class="line">npm init  <span class="comment">//输入任意项目名，其他可使用默认</span></span><br><span class="line">vim package.json</span><br></pre></td></tr></table></figure>
<p>修改package.json 如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"anyname"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"webpack-dev-server --hot --inline"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">"zhangjingfeng"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"babel-core"</span>: <span class="string">"^6.14.0"</span>,</span><br><span class="line">    <span class="string">"babel-loader"</span>: <span class="string">"^6.2.5"</span>,</span><br><span class="line">    <span class="string">"babel-plugin-transform-class-properties"</span>: <span class="string">"^6.11.5"</span>,</span><br><span class="line">    <span class="string">"babel-plugin-transform-regenerator"</span>: <span class="string">"^6.14.0"</span>,</span><br><span class="line">    <span class="string">"babel-plugin-transform-runtime"</span>: <span class="string">"^6.12.0"</span>,</span><br><span class="line">    <span class="string">"babel-preset-es2015"</span>: <span class="string">"^6.14.0"</span>,</span><br><span class="line">    <span class="string">"babel-preset-es2015-webpack"</span>: <span class="string">"^6.4.3"</span>,</span><br><span class="line">    <span class="string">"babel-preset-stage-0"</span>: <span class="string">"^6.5.0"</span>,</span><br><span class="line">    <span class="string">"html-webpack-plugin"</span>: <span class="string">"^2.22.0"</span>,</span><br><span class="line">    <span class="string">"webpack-dev-server"</span>: <span class="string">"^1.15.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>安装依赖包</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install --save-dev</span><br></pre></td></tr></table></figure>
<p>文件目录结构如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- 	src</span><br><span class="line">    |--js</span><br><span class="line">    |  |--index.js（webpack入口文件）</span><br><span class="line">    |  |--video-capture.js（视频截帧组件）</span><br><span class="line">    |</span><br><span class="line">    |--view</span><br><span class="line">       |--index.html（html页面）</span><br><span class="line">       </span><br><span class="line">-  dist</span><br><span class="line">    |--js(空目录)</span><br><span class="line">       </span><br><span class="line">-  package.json</span><br><span class="line">-  webpack.config.js（webpack配置文件）</span><br></pre></td></tr></table></figure>
<p>添加webpack.config.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> HtmlwebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">var</span> ROOT_PATH = path.resolve(__dirname);</span><br><span class="line"><span class="keyword">var</span> SRC_PATH = path.resolve(ROOT_PATH, <span class="string">'./src/js'</span>);</span><br><span class="line"><span class="keyword">var</span> DIST_PATH = path.resolve(ROOT_PATH, <span class="string">'dist/js'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: SRC_PATH,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: DIST_PATH,</span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlwebpackPlugin(&#123;</span><br><span class="line">      template:<span class="string">'./src/view/index.html'</span>    <span class="comment">//html模板路径</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  devtool: <span class="string">'inline-source-map'</span>,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">    inline: <span class="literal">true</span>,</span><br><span class="line">    progress: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: SRC_PATH,</span><br><span class="line">        loader: <span class="string">'babel?presets[]=es2015,presets[]=stage-0'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>添加src/js/index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import  Capture from &apos;./video-capture&apos;;</span><br><span class="line">function $(context) &#123;</span><br><span class="line">    return document.querySelector(context);</span><br><span class="line">&#125;</span><br><span class="line">let options = &#123;</span><br><span class="line">    video: $(&apos;#video&apos;),</span><br><span class="line">    output: $(&apos;#output&apos;),</span><br><span class="line">    btn: $(&apos;#btn&apos;),</span><br><span class="line">    fileInput: $(&apos;#fileInput&apos;),</span><br><span class="line">    cb: function (file) &#123;</span><br><span class="line">        $(&apos;#blobText&apos;).innerText = file.toLocaleString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let cp = new Capture.Capture(options);</span><br><span class="line">$(&apos;#blobText&apos;).addEventListener(&apos;click&apos;, ()=&gt;&#123;</span><br><span class="line">    cp.getFile().then(function (blob) &#123;</span><br><span class="line">        console.log(blob);</span><br><span class="line">    &#125;, (e)=&gt;&#123;</span><br><span class="line">        console.log(e);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>添加src/js/video-capture.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Capture</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(&#123;video, output, btn, fileInput, cb&#125;) &#123;</span><br><span class="line">        <span class="keyword">this</span>.init(video, output, btn, fileInput, cb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    last;</span><br><span class="line"></span><br><span class="line">    init(video, output, btn, fileInput, cb) &#123;</span><br><span class="line">        btn.addEventListener(<span class="string">'click'</span>, e =&gt; &#123;</span><br><span class="line">            <span class="keyword">let</span> c = <span class="keyword">this</span>.last = <span class="built_in">document</span>.createElement(<span class="string">"canvas"</span>);</span><br><span class="line">            [c.width, c.height] = [video.videoWidth, video.videoHeight];</span><br><span class="line">            c.getContext(<span class="string">'2d'</span>).drawImage(video, <span class="number">0</span>, <span class="number">0</span>, c.width, c.height);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> imgSrc = c.toDataURL();</span><br><span class="line">                output.innerHTML = <span class="string">`&lt;img src="<span class="subst">$&#123;imgSrc&#125;</span>"&gt;`</span>;</span><br><span class="line">                c.toBlob(cb);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                output.innerHTML = <span class="string">`</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                        &lt;p style="text-align: center;"&gt;浏览器不支持视频截帧&lt;/p&gt;</span><br><span class="line">                        &lt;p style="text-align: center;"&gt;请查看&lt;a href="http://wiki.baidu.com/pages/viewpage.action?pageId=208138996" target="_blank"&gt;使用帮助&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                `</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        fileInput &amp;&amp; fileInput.addEventListener(<span class="string">'change'</span>, () =&gt; &#123;</span><br><span class="line">            <span class="keyword">let</span> c = <span class="keyword">this</span>.last = fileInput;</span><br><span class="line">            <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">            reader.onload = (<span class="function"><span class="keyword">function</span>(<span class="params">output</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">let</span> imgSrc = e.target.result;</span><br><span class="line">                    output.innerHTML = <span class="string">`&lt;img src="<span class="subst">$&#123;imgSrc&#125;</span>"&gt;`</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;)(output);</span><br><span class="line">            reader.readAsDataURL(c.files[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">                cb.bind(<span class="keyword">this</span>)(c.files[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getFile() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.last &amp;&amp; <span class="keyword">this</span>.last <span class="keyword">instanceof</span> HTMLCanvasElement) &#123;</span><br><span class="line">                <span class="keyword">this</span>.last.toBlob(resolve);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.last &amp;&amp; <span class="keyword">this</span>.last <span class="keyword">instanceof</span> HTMLInputElement) &#123;</span><br><span class="line">                resolve(<span class="keyword">this</span>.last.files[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                reject(<span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;Capture&#125;;</span><br></pre></td></tr></table></figure>
<p>添加src/view/index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"date"</span> <span class="attr">content</span>=<span class="string">"2016-09-03"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"webpack es2015"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span><br><span class="line">        .c-btn-primary &#123;</span><br><span class="line">            background-color: #f8f8f8;</span><br><span class="line">            border-color: #d0d0d0;</span><br><span class="line">            border-bottom-color: #b2b2b2;</span><br><span class="line">            -webkit-box-shadow: 0 1px 1px 0 #e1e1e1;</span><br><span class="line">            box-shadow: 0 1px 1px 0 #e1e1e1;</span><br><span class="line">        &#125;</span><br><span class="line">        .c-btn &#123;</span><br><span class="line">            display: inline-block;</span><br><span class="line">            padding: 0 9px;</span><br><span class="line">            width: 60px;</span><br><span class="line">            height: 38px;</span><br><span class="line">            line-height: 37px;</span><br><span class="line">            font-size: 14px;</span><br><span class="line">            font-weight: normal;</span><br><span class="line">            text-decoration: none;</span><br><span class="line">            text-align: center;</span><br><span class="line">            color: #333;</span><br><span class="line">            background-color: #fff;</span><br><span class="line">            border: 1px solid #d9d9d9;</span><br><span class="line">            border-bottom-color: #bababa;</span><br><span class="line">            border-radius: 2px;</span><br><span class="line">            vertical-align: middle;</span><br><span class="line">            overflow: hidden;</span><br><span class="line">            outline: none;</span><br><span class="line">            -webkit-tap-highlight-color: rgba(255, 0, 0, 0);</span><br><span class="line">        &#125;</span><br><span class="line">        #fileInput[type="file" i]::-webkit-file-upload-button &#123;</span><br><span class="line">            -webkit-appearance: none;</span><br><span class="line">            padding-left: 0;</span><br><span class="line">            background: #fff;</span><br><span class="line">            border: none;</span><br><span class="line">        &#125;</span><br><span class="line">        #output &#123;</span><br><span class="line">            max-height: 300px;</span><br><span class="line">        &#125;</span><br><span class="line">        #output img&#123;</span><br><span class="line">            max-height: 300px;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"up"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wa-bdplayer wa-bdplayer-inline"</span> <span class="attr">style</span>=<span class="string">"display: inline-block; vertical-align: top;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wa-video-box"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">class</span>=<span class="string">"c-videoplayer"</span> <span class="attr">src</span>=<span class="string">"http://v1.bdstatic.com/7e313590bc0d1eb605c376b326538356/mp4/7e313590bc0d1eb605c376b326538356.mp4"</span> <span class="attr">type</span>=<span class="string">"video/mp4"</span> <span class="attr">autoplay</span>=<span class="string">"autoplay"</span> <span class="attr">controls</span>=<span class="string">""</span> <span class="attr">poster</span>=<span class="string">"http://p1.bdstatic.com/7217528220198269875.jpg"</span> <span class="attr">preload</span>=<span class="string">"none"</span> <span class="attr">height</span>=<span class="string">"210"</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"btn"</span> <span class="attr">class</span>=<span class="string">"c-btn c-btn-primary"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>截图<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"fileInput"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">class</span>=<span class="string">"c-btn c-btn-primary"</span> <span class="attr">value</span>=<span class="string">"上传"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"output"</span> <span class="attr">style</span>=<span class="string">"display: inline-block; vertical-align: top;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"down"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"blobText"</span>&gt;</span>text<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>粘贴代码的工作结束了，在项目根目录下输入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack --save-dev</span><br><span class="line">webpack</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>
<p>会出现<code>webpack: bundle is now VALID.</code>此时，打开浏览器，输入localhost:8080即可</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://korubak.github.io/es2015入门.html" data-id="cispomvgp0007519kau983rgg" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ECMAScript/">ECMAScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/test-another.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>


  
</article>


</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul id="recent-post" class="">
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/es2015入门.html" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/front-end/">front-end</a></p>
              <p class="item-title"><a href="/es2015入门.html" class="title">es2015入门</a></p>
              <p class="item-date"><time datetime="2016-09-07T07:38:00.000Z" itemprop="datePublished">2016-09-07</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/test-another.html" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/others/">others</a></p>
              <p class="item-title"><a href="/test-another.html" class="title">Hello World</a></p>
              <p class="item-date"><time datetime="2016-06-21T12:19:56.000Z" itemprop="datePublished">2016-06-21</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/test-another-1.html" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"></p>
              <p class="item-title"><a href="/test-another-1.html" class="title">test-another</a></p>
              <p class="item-date"><time datetime="2016-06-14T12:19:57.000Z" itemprop="datePublished">2016-06-14</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/hello-world.html" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/others/">others</a></p>
              <p class="item-title"><a href="/hello-world.html" class="title">Hello World</a></p>
              <p class="item-date"><time datetime="2016-05-19T12:26:37.000Z" itemprop="datePublished">2016-05-19</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/front-end/">front-end</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript/">ECMAScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/others/">others</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/ECMAScript/" style="font-size: 10px;">ECMAScript</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/others/" style="font-size: 20px;">others</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 - 2016 Zhang Jingfeng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    



 <script src="//cdn.css.net/libs/jquery/2.1.3/jquery.min.js"></script>




  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>